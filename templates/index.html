<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF & URL QA App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f3f4f6;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            height: 100vh;
            overflow-y: auto;
        }

        .container {
            background-color: #ffffff;
            width: 90%;
            max-width: 800px;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        h1, h2 {
            color: #2563eb;
            text-align: center;
        }

        input[type="file"], input[type="text"] {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }

        button {
            background-color: #2563eb;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            display: block;
            width: 100%;
            margin-top: 10px;
        }

        button:hover {
            background-color: #1d4ed8;
        }

        .progress {
            display: none;
            margin-top: 20px;
            text-align: center;
        }

        .progress i {
            color: #2563eb;
            font-size: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .response-container {
            display: flex;
            flex-direction: row;
            gap: 20px;
            margin-top: 20px;
        }

        .response-box {
            background-color: #f8fafc;
            padding: 20px;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
            flex: 1;
        }

        .response-box h3 {
            margin-top: 0;
            color: #2563eb;
        }

        #upload-response {
            margin: 10px 0;
            padding: 10px;
            border-radius: 6px;
            font-size: 16px;
        }

        .success {
            background-color: #dcfce7;
            color: #166534;
        }

        .error {
            background-color: #fee2e2;
            color: #991b1b;
        }

        #file-names {
            margin-top: 10px;
            font-size: 14px;
            color: #555;
        }

        #file-names span {
            display: block;
        }
    </style>
</head>
<body>
    <h1>PDF & URL QA Application</h1>

    <div class="container">
        <h2>Upload PDF or Provide Website URL</h2>
        <form id="upload-form" enctype="multipart/form-data">
            <label for="file-input">Upload PDFs:</label>
            <input type="file" name="files" id="file-input" accept="application/pdf" multiple>
            <div id="file-names"></div>

            <label for="url-input">Website URL:</label>
            <input type="text" name="url" id="url-input" placeholder="Enter website URL">

            <button type="submit">Submit</button>
        </form>
        <div id="upload-response"></div>
        <div class="progress" id="upload-progress">
            <i class="fas fa-spinner"></i>
            <p>Processing your input, please wait...</p>
        </div>
    </div>

    <div class="container">
        <h2>Ask a Question</h2>
        <form id="question-form">
            <input type="text" id="question-input" placeholder="Enter your question here..." required>
            <button type="submit" id="submit-button" disabled>Ask Question</button>
        </form>

        <div class="response-container">
            <div class="response-box">
                <h3>Answer with Context (RAG)</h3>
                <div id="rag-answer"></div>
            </div>
            <div class="response-box">
                <h3>Answer without Context (LLM)</h3>
                <div id="direct-answer"></div>
            </div>
        </div>
        <div class="progress" id="question-progress">
            <i class="fas fa-spinner"></i>
            <p>Fetching the answer, please wait...</p>
        </div>
    </div>

    <script>
        const uploadForm = document.getElementById('upload-form');
        const questionForm = document.getElementById('question-form');
        const fileInput = document.getElementById('file-input');
        const fileNames = document.getElementById('file-names');
        const submitButton = document.getElementById('submit-button');
        const uploadResponse = document.getElementById('upload-response');
        const uploadProgress = document.getElementById('upload-progress');
        const questionProgress = document.getElementById('question-progress');
        const ragAnswer = document.getElementById('rag-answer');
        const directAnswer = document.getElementById('direct-answer');

        fileInput.addEventListener('change', () => {
            const files = Array.from(fileInput.files);
            fileNames.innerHTML = files.map(file => `<span>${file.name}</span>`).join('');
        });

        uploadForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(uploadForm);

            uploadResponse.innerText = '';
            uploadResponse.className = '';
            uploadProgress.style.display = 'block';

            try {
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (response.ok) {
                    uploadResponse.className = 'success';
                    submitButton.disabled = false;
                } else {
                    uploadResponse.className = 'error';
                }
                uploadResponse.innerText = result.message || result.error;
            } catch (error) {
                uploadResponse.className = 'error';
                uploadResponse.innerText = 'Error processing inputs';
            } finally {
                uploadProgress.style.display = 'none';
            }
        });

        questionForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const question = document.getElementById('question-input').value;

            ragAnswer.innerText = '';
            directAnswer.innerText = '';
            questionProgress.style.display = 'block';
            submitButton.disabled = true;

            try {
                const [ragResponse, directResponse] = await Promise.all([
                    fetch('/ask', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ question })
                    }),
                    fetch('/ask_direct', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ question })
                    })
                ]);

                const ragResult = await ragResponse.json();
                const directResult = await directResponse.json();

                ragAnswer.innerText = ragResult.answer || ragResult.error;
                directAnswer.innerText = directResult.answer || directResult.error;
            } catch (error) {
                ragAnswer.innerText = 'Error getting response';
                directAnswer.innerText = 'Error getting response';
            } finally {
                questionProgress.style.display = 'none';
                submitButton.disabled = false;
            }
        });
    </script>
</body>
</html>
